{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Summary - OncoOne Payments</title>
    <link rel="shortcut icon" href="{% static 'assets/images/logos.png' %}" type="image/png" />
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'style.css' %}" />
    <style>
        .payment-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .payment-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }
        
        .payment-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }
        
        .payment-header h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 5px;
        }
        
        .payment-header p {
            color: #666;
            font-size: 14px;
        }
        
        .summary-section {
            margin-bottom: 30px;
        }
        
        .summary-title {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            color: #333;
            font-size: 14px;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .summary-row .label {
            color: #666;
        }
        
        .summary-row .value {
            color: #333;
            font-weight: 600;
        }
        
        .summary-row.total {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: none;
            margin-top: 10px;
            font-size: 18px;
        }
        
        .summary-row.total .label {
            color: #333;
            font-weight: bold;
        }
        
        .summary-row.total .value {
            color: #667eea;
            font-weight: bold;
            font-size: 18px;
        }
        
        .balance-info {
            background: #e8f4f8;
            padding: 15px;
            border-left: 4px solid #00bcd4;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .balance-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }
        
        .balance-row .label {
            color: #00796b;
            font-weight: 600;
        }
        
        .balance-row .value {
            color: #00796b;
            font-weight: 600;
        }
        
        .terms-section {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
        
        .checkbox-group {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-top: 4px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-label {
            font-size: 13px;
            color: #333;
            line-height: 1.4;
            cursor: pointer;
            flex: 1;
        }
        
        .checkbox-label a {
            color: #667eea;
            text-decoration: none;
        }
        
        .checkbox-label a:hover {
            text-decoration: underline;
        }

        /* Policy modal */
        .policy-modal {
            position: fixed;
            inset: 0;
            background: rgba(26, 66, 114, 0.75);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 9999;
            animation: fadeIn 0.3s ease;
        }

        .policy-modal.show { display: flex; }

        .policy-dialog {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #1a202c;
            max-width: 800px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            border-radius: 20px;
            padding: 40px 36px;
            box-shadow: 0 25px 60px rgba(26, 66, 114, 0.3), 0 0 0 1px rgba(26, 66, 114, 0.1);
            position: relative;
            animation: slideUp 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .policy-close {
            position: absolute;
            top: 16px;
            right: 16px;
            border: none;
            background: linear-gradient(135deg, #1a4272 0%, #2a5a9a 100%);
            color: #ffffff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(26, 66, 114, 0.2);
        }

        .policy-close:hover {
            background: linear-gradient(135deg, #2a5a9a 0%, #1a4272 100%);
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 6px 18px rgba(26, 66, 114, 0.3);
        }

        .policy-title {
            margin-top: 0;
            margin-bottom: 8px;
            color: #1a4272;
            font-size: 28px;
            font-weight: 700;
            border-bottom: 3px solid #1a4272;
            padding-bottom: 12px;
        }

        .policy-meta {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 20px;
            font-style: italic;
        }

        .policy-dialog p {
            line-height: 1.7;
            color: #2d3748;
            margin-bottom: 14px;
        }

        .policy-section-title {
            margin: 24px 0 12px;
            font-weight: 700;
            font-size: 18px;
            color: #1a4272;
            padding-left: 12px;
            border-left: 4px solid #1a4272;
            background: rgba(26, 66, 114, 0.05);
            padding: 10px 12px;
            border-radius: 6px;
        }

        .policy-list {
            padding-left: 24px;
            margin: 12px 0;
        }

        .policy-list li {
            margin-bottom: 8px;
            color: #2d3748;
            line-height: 1.6;
        }

        .policy-list em {
            color: #667eea;
            font-weight: 600;
        }

        .policy-dialog::-webkit-scrollbar {
            width: 8px;
        }

        .policy-dialog::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .policy-dialog::-webkit-scrollbar-thumb {
            background: #1a4272;
            border-radius: 10px;
        }

        .policy-dialog::-webkit-scrollbar-thumb:hover {
            background: #2a5a9a;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        .btn-primary {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            flex: 1;
            padding: 12px;
            background: #f0f0f0;
            color: #333;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: #e8e8e8;
            border-color: #bbb;
        }
        
        .error-message {
            padding: 12px;
            background-color: #fee;
            color: #c33;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            font-size: 14px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="payment-container">
        <div class="payment-card">
            <div class="payment-header">
                <h1>Payment Summary</h1>
                <p>Review your payment details before continuing</p>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            
            <!-- Student Information -->
            <div class="summary-section">
                <div class="summary-title">Student Information</div>
                <div class="summary-row">
                    <span class="label">Student ID:</span>
                    <span class="value">{{ student_id }}</span>
                </div>
                <div class="summary-row">
                    <span class="label">Name:</span>
                    <span class="value">{{ student.name }}</span>
                </div>
                <div class="summary-row">
                    <span class="label">Email:</span>
                    <span class="value">{{ student.email }}</span>
                </div>
                <div class="summary-row">
                    <span class="label">Registration Number:</span>
                    <span class="value">{{ student.registration_number }}</span>
                </div>
            </div>
            
            <!-- Course Information -->
            <div class="summary-section">
                <div class="summary-title">Course Information</div>
                <div class="summary-row">
                    <span class="label">Course Name:</span>
                    <span class="value">{{ course }}</span>
                </div>
                <div class="summary-row">
                    <span class="label">Full Course Fee:</span>
                    <span class="value">{{ currency }} ${{ course_full_price }}</span>
                </div>
            </div>
            
            <!-- Payment Amount -->
            <div class="summary-section">
                <div class="summary-title">Payment Details</div>
                <div class="summary-row">
                    <span class="label">Payment Amount:</span>
                    <span class="value">{{ currency }} ${{ payment_amount }}</span>
                </div>
                <div class="summary-row">
                    <span class="label">Tax (13% HST):</span>
                    <span class="value">{{ currency }} ${{ tax_amount }}</span>
                </div>
                <div class="summary-row total">
                    <span class="label">Total Amount to Pay:</span>
                    <span class="value">{{ currency }} ${{ total_amount }}</span>
                </div>
            </div>
            
            <!-- Remaining Balance -->
            <div class="balance-info">
                <div class="balance-row">
                    <span class="label">Remaining Balance:</span>
                    <span class="value">{{ currency }} ${{ remaining_balance }}</span>
                </div>
                <div style="font-size: 12px; color: #00796b; margin-top: 5px;">
                    You will still owe this amount after this payment
                </div>
            </div>
            
            <!-- Terms and Conditions -->
            <form id="summaryForm" onsubmit="proceedToPayment(event)">
                <div class="terms-section">
                    <div class="checkbox-group">
                        <input 
                            type="checkbox" 
                            id="termsCheck" 
                            name="terms_agreed"
                            required
                        />
                        <label for="termsCheck" class="checkbox-label">
                            I agree to the terms and conditions and authorize this payment. I have reviewed the
                            <a href="#" onclick="openPolicyModal('privacyModal'); return false;">Privacy Policy</a>
                            and
                            <a href="#" onclick="openPolicyModal('conductModal'); return false;">Student Code of Conduct</a>.
                        </label>
                    </div>
                </div>
                
                <!-- Buttons -->
                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="goBack()">← Back</button>
                    <button type="submit" class="btn-primary" id="proceedBtn">
                        PAY NOW
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacyModal" class="policy-modal" role="dialog" aria-modal="true" aria-labelledby="privacyTitle" onclick="if(event.target === this) closePolicyModal('privacyModal');">
        <div class="policy-dialog" onclick="event.stopPropagation();">
            <button class="policy-close" aria-label="Close" onclick="closePolicyModal('privacyModal')">×</button>
            <h3 id="privacyTitle" class="policy-title">Privacy Policy Notice</h3>
            <div class="policy-meta">OncoOne Aesthetic School · Last Updated: 2026.01.10</div>
            <p>OncoOne Aesthetic School ("OncoOne", "we", "our", or "us") is a non-profit educational organization providing oncology-related aesthetic courses. We are committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you visit our website or register for our courses.</p>

            <div class="policy-section-title">1. Information We Collect</div>
            <p><strong>a. Personal Information</strong></p>
            <ul class="policy-list">
                <li>Full name</li>
                <li>Email address</li>
                <li>Phone number</li>
                <li>Professional or educational details (if provided during registration)</li>
            </ul>
            <p><strong>b. Payment Information</strong></p>
            <ul class="policy-list">
                <li>Payment amount</li>
                <li>Transaction reference number</li>
                <li>Payment status</li>
                <li><em>Note:</em> We do not store or process credit/debit card details directly. All payments are securely handled by third-party payment gateway providers.</li>
            </ul>
            <p><strong>c. Technical Information</strong></p>
            <ul class="policy-list">
                <li>IP address</li>
                <li>Browser type and device information</li>
                <li>Pages visited and interaction data (for analytics purposes)</li>
            </ul>

            <div class="policy-section-title">2. How We Use Your Information</div>
            <p>We use the collected information to:</p>
            <ul class="policy-list">
                <li>Process course registrations and payments</li>
                <li>Send confirmation and administrative emails</li>
                <li>Communicate course updates and important notices</li>
                <li>Maintain internal records for academic and compliance purposes</li>
                <li>Improve website functionality and user experience</li>
            </ul>
            <p>As a non-profit organization, we do not sell, rent, or trade your personal data.</p>

            <div class="policy-section-title">3. Payment Security</div>
            <p>All online payments are processed through secure, PCI-DSS-compliant payment gateways. OncoOne Aesthetic School does not have access to your full card details.</p>

            <div class="policy-section-title">4. Data Sharing and Disclosure</div>
            <p>We may share your information only with trusted service providers (e.g., payment gateways, email services) or legal/regulatory authorities when required by law. All third parties are obligated to keep your data confidential and secure.</p>

            <div class="policy-section-title">5. Data Retention</div>
            <p>We retain personal information only for as long as necessary to fulfill educational and administrative purposes or to comply with legal, accounting, or regulatory requirements.</p>

            <div class="policy-section-title">6. Your Rights</div>
            <p>You have the right to request access, correction, or deletion of your data, and to withdraw consent for communications at any time. Requests can be made using the contact details below.</p>

            <div class="policy-section-title">7. Cookies</div>
            <p>Our website may use cookies to enhance user experience and analyze website traffic. You may disable cookies through your browser settings if you prefer.</p>

            <div class="policy-section-title">8. Data Protection</div>
            <p>We implement appropriate technical and organizational security measures to protect your information against unauthorized access, alteration, disclosure, or destruction.</p>

            <div class="policy-section-title">9. Changes to This Policy</div>
            <p>We may update this Privacy Policy from time to time. Any changes will be posted on this page with an updated revision date.</p>

            <div class="policy-section-title">10. Contact Us</div>
            <div style="background: linear-gradient(135deg, #f0f4f8 0%, #e8f2ff 100%); border-radius: 12px; padding: 24px; margin-top: 16px; border: 2px solid #1a4272; box-shadow: 0 4px 12px rgba(26, 66, 114, 0.1);">
                <div style="text-align: center; margin-bottom: 16px;">
                    <div style="display: inline-block; background: linear-gradient(135deg, #1a4272 0%, #2a5a9a 100%); color: white; padding: 8px 20px; border-radius: 25px; font-weight: 700; font-size: 16px; box-shadow: 0 4px 8px rgba(26, 66, 114, 0.2);">
                        OncoOne Aesthetic School
                    </div>
                </div>
                <div style="display: grid; gap: 12px; margin-top: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: white; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); transition: transform 0.2s ease;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #1a4272 0%, #2a5a9a 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <svg width="20" height="20" fill="white" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #718096; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Email</div>
                            <a href="mailto:info@oncoesthetics.ca" style="color: #1a4272; font-weight: 600; text-decoration: none; font-size: 15px;">info@oncoesthetics.ca</a>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: white; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); transition: transform 0.2s ease;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #1a4272 0%, #2a5a9a 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <svg width="20" height="20" fill="white" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #718096; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Website</div>
                            <a href="https://www.oncoesthetics.ca" target="_blank" style="color: #1a4272; font-weight: 600; text-decoration: none; font-size: 15px;">www.oncoesthetics.ca</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Code of Conduct Modal -->
    <div id="conductModal" class="policy-modal" role="dialog" aria-modal="true" aria-labelledby="conductTitle" onclick="if(event.target === this) closePolicyModal('conductModal');">
        <div class="policy-dialog" onclick="event.stopPropagation();">
            <button class="policy-close" aria-label="Close" onclick="closePolicyModal('conductModal')">×</button>
            <h3 id="conductTitle" class="policy-title">Student Code of Conduct</h3>
            <p>To maintain a safe, respectful, and professional learning environment, all students agree to the following:</p>

            <div class="policy-section-title">Professionalism</div>
            <ul class="policy-list">
                <li>Arrive prepared, punctual, and ready to learn.</li>
                <li>All materials used belong to OncoOne unless part of your kit; if property is damaged or misused, the student is responsible.</li>
                <li>Maintain professional behaviour and communication.</li>
                <li>Follow all safety and sanitation protocols.</li>
            </ul>

            <div class="policy-section-title">Respect & Trauma-Informed Behaviour</div>
            <ul class="policy-list">
                <li>Treat peers, instructors, and clients with empathy, dignity, and compassion.</li>
                <li>Honour the lived experiences of cancer patients and survivors.</li>
                <li>Maintain a calm, supportive presence.</li>
            </ul>

            <div class="policy-section-title">Privacy & Confidentiality</div>
            <ul class="policy-list">
                <li>Protect all personal information shared in class and do not share outside the OncoOne classroom.</li>
                <li>No recording or photography unless authorized.</li>
                <li>Patient confidentiality is enforced and should only be discussed within the program and in class.</li>
            </ul>

            <div class="policy-section-title">Hygiene & Safety</div>
            <ul class="policy-list">
                <li>Follow oncology-safe sanitation and disinfection protocols.</li>
                <li>Maintain a clean, professional appearance; hair tied back and closed shoes.</li>
                <li>Report safety concerns immediately.</li>
                <li>Wear perfume sparingly; cancer patients are sensitive to smells.</li>
            </ul>

            <div class="policy-section-title">Zero-Tolerance Policies</div>
            <ul class="policy-list">
                <li>Harassment, discrimination, unsafe practice, dishonesty, or breach of confidentiality may result in dismissal with no refund.</li>
            </ul>
        </div>
    </div>
    
    <script>
        const studentId = {{ student_id }};
        const paymentAmount = {{ payment_amount }};
        const taxAmount = {{ tax_amount }};
        const totalAmount = {{ total_amount }};
        const currency = "{{ currency }}";
        const enrollmentId = {{ enrollment.id }};
        
        function proceedToPayment(event) {
            event.preventDefault();
            
            const termsCheck = document.getElementById('termsCheck').checked;
            
            if (!termsCheck) {
                const errorMsg = document.getElementById('errorMessage');
                errorMsg.textContent = 'You must agree to the terms and conditions';
                errorMsg.style.display = 'block';
                return;
            }
            
            // Redirect to card entry page with enrollment
            const url = `/api/payment/card-entry/${studentId}/?enrollment_id=${enrollmentId}&amount=${paymentAmount}&tax=${taxAmount}&total=${totalAmount}`;
            window.location.href = url;
        }
        
        function goBack() {
            window.location.href = `/api/payment/select-course/${studentId}/`;
        }

        function openPolicyModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        function closePolicyModal(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        }
    </script>
</body>
</html>
